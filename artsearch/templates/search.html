{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mx-auto p-4">

    <!-- Text above search form -->
    <p class="text-sm text-gray-700 mb-2 mt-4">
        {{ about_text }}
    </p>

    <!-- Search Form -->
    <div class="mb-5">
        <form id="search-form" method="GET" action="{% url search_action_url %}" class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-2">
            <!-- Search Input -->
            <input
                id="search-input"
                type="text"
                name="query"
                placeholder="{{ placeholder }}"
                value="{{ query|default:'' }}"
                class="w-full sm:w-auto flex-grow px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                required
            />

            <!-- Dropdown for Limit -->
            <div class="relative w-full sm:w-auto">
                <select
                    name="limit"
                    class="block w-full px-3 py-2 border border-gray-300 rounded-lg appearance-none pr-8 focus:ring-2 focus:ring-blue-500 focus:outline-none"
                >
                    <option value="5" {% if limit == 5 %}selected{% endif %}>5</option>
                    <option value="10" {% if limit == 10 %}selected{% endif %}>10</option>
                    <option value="20" {% if limit == 20 %}selected{% endif %}>20</option>
                    <option value="50" {% if limit == 50 %}selected{% endif %}>50</option>
                </select>
            </div>

            <!-- Search Button -->
            <button
                type="submit"
                class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
                Search
            </button>
        </form>
    </div> <!-- End Search Form -->

    {% if example_queries %}
    <!-- Example Queries -->
    <div class="mb-5">
        <p class="text-sm text-gray-600 mb-2">Try these examples:</p>
        <div class="flex flex-wrap gap-2">
            {% for example in example_queries %}
            <button
                type="button"
                class="bg-gray-200 text-gray-800 px-3 py-1 rounded-lg text-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                onclick="submitQuery('{{ example }}')"
            >
                {{ example }}
            </button>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Error Message -->
    {% if error_message %}
    <div class="
        {% if error_type == 'error' %} bg-red-100 border-red-500 text-red-700
        {% elif error_type == 'warning' %} bg-yellow-100 border-yellow-500 text-yellow-700
        {% else %} bg-blue-100 border-blue-500 text-blue-700 {% endif %}
        border-l-4 p-4 mb-4">
        <p>{{ error_message }}</p>
    </div>
    {% endif %}

    <!-- Content Section -->
    {% if results %}
        <!-- Search Results -->
        <div class="mb-2">
            <p class="text-sm text-gray-500">
                Showing {{ results|length }} search results (best match first)
            </p>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
            {% for result in results %}
                {% include 'partials/_artwork_card.html' %}
            {% endfor %}
        </div>
    {% elif random_results %}
        <!-- Random Artworks -->
        <div class="mb-2">
            <p class="text-sm text-gray-500">A glimpse into the archive</p>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
            {% for result in random_results %}
                {% include 'partials/_artwork_card.html' %}
            {% endfor %}
        </div>
    {% endif %}

    <!-- Thumbnail Image Modal -->
    <div x-data="{ isOpen: false, imageUrl: '' }"
        x-show="isOpen"
        class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-50"
        @open-modal.window="
            imageUrl = $event.detail.imageUrl;
            isOpen = true;
        "
        x-transition.opacity
        x-cloak>

        <!-- Modal Card -->
        <div class="bg-white rounded-lg shadow-lg max-w-3xl mx-auto relative" @click="isOpen = false">
            <div class="p-4">
                <img :src="imageUrl"
                    alt="Artwork"
                    class="rounded-lg shadow-md max-w-full max-h-[80vh]">
            </div>
        </div>
    </div>

    <!-- JavaScript Functions -->
    <script>
        function openModal(imageUrl) {
            window.dispatchEvent(new CustomEvent('open-modal', { detail: { imageUrl } }));
        }

        function submitQuery(query) {
            document.getElementById('search-input').value = query;
            document.getElementById('search-form').submit();
        }
    </script>

</div> <!-- End Container -->

{% endblock content %}
