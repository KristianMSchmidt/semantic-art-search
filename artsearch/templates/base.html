{% load static %}
{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Semantic Art Search</title>
		<link rel="manifest" href="{% static 'site.webmanifest' %}">
		<link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="author" content="Kristian Møller Schmidt" />

		<!-- SEO: Meta Description -->
		<meta name="description" content="Search art collections using natural language — by theme, mood, or style — and find visually or semantically similar works across museums.">

		<!-- Open Graph (for social media previews) -->
		<meta property="og:title" content="Semantic Art Search" />
		<meta property="og:description" content="Search art collections using natural language — by theme, mood, or style — and find visually or semantically similar works across museums." />
		<meta property="og:image" content="https://iip-thumb.smk.dk/iiif/jp2/kd17cx80w_KMSr171-crop.tif.jp2/full/!1024,/0/default.jpg"/>
		<meta property="og:url" content="https://semantic-art-search.com" />
		<meta property="og:type" content="website" />

		<!-- Twitter -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:url" content="https://semantic-art-search.com" />
		<meta name="twitter:title" content="Semantic Art Search" />
		<meta name="twitter:description" content="Search art collections using natural language — by theme, mood, or style — and find visually or semantically similar works across museums." />
		<meta name="twitter:image" content="https://iip-thumb.smk.dk/iiif/jp2/kd17cx80w_KMSr171-crop.tif.jp2/full/!1024,/0/default.jpg" />

		{% tailwind_css %}
		<style>
        [x-cloak] {
            display: none !important;
        }
    </style>
		<script src="https://unpkg.com/htmx.org@2.0.4"></script>
		<script>
			// i18n store for Alpine.js
			document.addEventListener('alpine:init', () => {
				Alpine.store('i18n', {
					locale: localStorage.getItem('searchLang') || 'en',
					translations: {},

					async init() {
						await this.loadTranslations(this.locale);
					},

					async loadTranslations(locale) {
						try {
							const response = await fetch(`/static/i18n/${locale}.json`);
							this.translations = await response.json();
							this.locale = locale;
						} catch (error) {
							console.error(`Failed to load translations for ${locale}:`, error);
							// Fallback to English if loading fails
							if (locale !== 'en') {
								const fallbackResponse = await fetch('/static/i18n/en.json');
								this.translations = await fallbackResponse.json();
								this.locale = 'en';
							}
						}
					},

					async setLocale(locale) {
						await this.loadTranslations(locale);
						localStorage.setItem('searchLang', locale);
					},

					t(key) {
						const keys = key.split('.');
						let value = this.translations;

						for (const k of keys) {
							if (value && typeof value === 'object' && k in value) {
								value = value[k];
							} else {
								console.warn(`Translation key not found: ${key}`);
								return key;
							}
						}

						return value;
					}
				});

				// Initialize translations on page load
				Alpine.store('i18n').init();
			});
		</script>
		<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
	</head>

	<body class="bg-gray-50 font-serif leading-normal tracking-normal">

		<!-- Base Navbar -->
		<nav class="bg-blue-500 p-4">
			<div class="container mx-auto flex justify-between items-center">
				<!-- Website Name -->
				<a href="{% url 'home' %}" class="text-blue-50 text-lg font-bold" x-text="$store.i18n.t('branding.title')"></a>
				<!-- Navbar links -->
				<div class="flex space-x-4 items-center">
					{% block nav_links %}
					{% endblock %}
				</div>
			</div>
		</nav>
		{% block content %}
		{% endblock %}
	</body>
</html>
